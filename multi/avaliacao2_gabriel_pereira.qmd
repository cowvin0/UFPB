---
title: Molusco abalone - O retorno
author: Gabriel de Jesus Pereira
date: '`r Sys.Date()`'
cache: true
execute:
  refresh: true
  warning: false
  error: false
  eval: true
  echo: true
revealjs-plugins:
  - attribution 
  - roughnotation
  - pointer
format: 
  revealjs:
    theme: [default, style.scss]
    embed-resources: true
    transition: slide
    background-transition: fade
    scrollable: true
    preview-links: auto
editor:
  markdown:
    wrap: 72
lang: pt-b
---

```{r echo=FALSE}
set.seed(42)
library(dplyr)
library(GGally)
library(visdat)
library(paletteer)
library(tidyr)
library(dendextend)
library(viridis)
library(hrbrthemes)
library(tibble)
library(cluster)
library(ggridges)
library(factoextra)
library(mclust)
library(ggplot2)
library(RVAideMemoire)
library(corrplot)
library(ggfortify)
set.seed(42)
```


# Introdução

## O que são os abalones

:::: {.columns}

::: {.column width="50%"}
- É um molusco gastrópode, podendo ser pequeno ou grande;

- Servem como alimento e joias para os seres humanos, sendo a China o principal consumidor
:::

::: {.column width="50%"}
![](https://www.e-fish.com/cdn/shop/files/1lbsabalone2.jpg?v=1696278727)
:::

::::

## Sobre o banco de dados

- É um banco de dados da área de biologia que contém medidas físicas de um abalone;

- O banco de dados contém 4177 observações;

- 8 colunas, sendo uma delas nominal e o restante numérica;

- Foi criado por Warwick Nash, Tracy Sellers, Simon Talbot, Andrew Cawthorn, Wes Ford.

## As variáveis do banco de dados {auto-animate="true"}

- Sexo do abalone: variável nominal indicando se o abalone é macho, fêmea ou filhote.

- Length: Medição do maior comprimento da concha

- Diameter: perpendicular ao comprimento

- Height: com carne na casca

## As variáveis do banco de dados

- Whole weight: abalone inteiro

- Shucked weight: peso da carne

- Viscera weight: peso das vísceras

- Shell weight: peso da concha sem carne

# Objetivo

Utilizar técnicas de classificação hierárquica, não-hierárquica e agrupamento paramétrico com dados de moluscos abalone.

# Leitura dos dados

```{r}
data <- readr::read_csv("abalone.csv") |>
  mutate(
    Sex = case_when(
      Sex == "F" ~ "Fêmea",
      Sex == "M" ~ "Macho",
      TRUE ~ "Filhote"
      )
    ) |> 
  select(- Rings)
```

# Classificação Hierárquica

## Dendograma

::: {.panel-tabset}

### Código

```{r output=FALSE}
data <- data |>
  (\(x) {
     scaled <- x |>
       select_if(is.numeric) |>
       scale() |>
       as_tibble()

     x |>
       select_if(is.character) |>
       cbind(scaled)
  })()

Mdist <- dist(data |> select_if(is.numeric), method = "euclidean")
CH1 <- hclust(Mdist)
plot(CH1,
     main=" ",
     labels = data$Sex,
     ylab = NULL, 
     ann = FALSE)
```

### Dendograma

```{r echo=FALSE}
Mdist <- dist(data |> select_if(is.numeric), method = "euclidean")
CH1 <- hclust(Mdist)
plot(CH1,
     main=" ",
     labels = data$Sex,
     ylab = NULL, 
     ann = FALSE)
rect.hclust(CH1, k = 3, border = c("#002951","#005129","#a0000a"))
```

:::

## Seleção do modelo

::: {.panel-tabset}

### Código

```{r output=FALSE}
Métodos <- c(
  "average", "single",
  "complete", "ward"
  )

Resultados <- data.frame(Método=Métodos , Critério = rep(0, length(Métodos)))

for (i in 1:length(Métodos)) {
  Resultados[i, 2] <- agnes(data, method = Métodos[i])$ac
}
```

### Método selecionado

|  Metodo  | Criterio |
|:--------:|:--------:|
|  Average |  0.9866  |
|  Single  |  0.9829  |
| Complete |  0.9881  |
|   Ward   |  0.9982  |

:::


## Dendograma do médodo selecionado

::: {.panel-tabset}

### Código

```{r output=FALSE}
CHward <- agnes(data, method = "ward") |> 
  as.hclust()
plot(CHward, main=" ", labels = substr(data$Sex, 1, 2), ylab = NULL, ann = FALSE)
rect.hclust(CHward, k = 3, border = c("#002951","#005129","#a0000a"))
corte3 <- cutree(CHward , k = 3)
```

### Dendograma

```{r echo=FALSE}
CHward <- agnes(data, method = "ward") |> 
  as.hclust()
plot(CHward, main=" ", labels = substr(data$Sex, 1, 2), ylab = NULL, ann = FALSE)
rect.hclust(CHward, k = 3, border = c("#002951","#005129","#a0000a"))
corte3 <- cutree(CHward , k = 3)
```

:::

## Biplot do método selecionado

::: {.panel-tabset}

### Código

```{r output=FALSE}
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex,1,2), 1:length(corte3))
fviz_cluster(list(data = mdados, cluster = corte3, show_labels = FALSE))
```

### Biplot

```{r echo=FALSE}
fviz_cluster(list(data = mdados, cluster = corte3, show_labels = FALSE))
```

:::

# Classificação Não-Hierárquica

## K-means

```{r}
semente <- round(aggregate(data |> select_if(is.numeric), by=list(cluster = data$Sex), mean)[,-1], 2)
```

```{r}
km <- kmeans(data |> select_if(is.numeric), centers = semente)
```

```{r}
table(data.frame(Especie=data$Sex, Classes=km$cluster))
```

```{r}
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex, 1, 2),1:dim(data)[1])
fviz_cluster(list(data = mdados, cluster = km$cluster,show_labels = FALSE))
```


# Agrupamento paramétrico

```{r}
BIC <- mclustBIC(data[,-1], G = 3)
plot(BIC)
summary(BIC)
```

```{r}
mod1 <- Mclust(data |> select_if(is.numeric), x = BIC)
summary(mod1)
```

```{r}
gg <- mod1$classification
table(data.frame(grupos=gg,especies=data$Sex))
```

```{r}
plot(mod1, what = "classification",col=c("#002951","#a0000a"))
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex,1,2),1:dim(data)[1])
fviz_cluster(list(data = mdados, cluster = gg,show_labels = FALSE))
```

```{r}
mod2 <- Mclust(data |> select_if(is.numeric), G=3, modelNames = "VVV")
summary(mod2, parameters = TRUE)
```

```{r}
gg <- mod2$classification
table(data.frame(grupos=gg,especies=data$Sex))
```

```{r}
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex,1,2),1:dim(data)[1])
fviz_cluster(list(data = mdados, cluster = gg, show_labels = FALSE))
```
