---
title: Molusco abalone
author: Gabriel de Jesus Pereira
date: '`r Sys.Date()`'
execute:
  refresh: true
  warning: false
  error: false
  eval: true
  echo: true
revealjs-plugins:
  - attribution 
  - roughnotation
  - pointer
format: 
  revealjs:
    theme: [default, style.scss]
    embed-resources: true
    transition: slide
    background-transition: fade
    scrollable: true
    preview-links: auto
editor:
  markdown:
    wrap: 72
lang: pt-b
---

```{r echo=FALSE}
set.seed(42)
library(dplyr)
library(GGally)
library(visdat)
library(paletteer)
library(tidyr)
library(dendextend)
library(viridis)
library(hrbrthemes)
library(tibble)
library(cluster)
library(ggridges)
library(factoextra)
library(mclust)
library(ggplot2)
library(RVAideMemoire)
library(corrplot)
library(ggfortify)
set.seed(42)
```


# Introdução

## O que são os abalones

:::: {.columns}

::: {.column width="50%"}
- É um molusco gastrópode, podendo ser pequeno ou grande;

- Servem como alimento e joias para os seres humanos, sendo a China o principal consumidor
:::

::: {.column width="50%"}
![](https://www.e-fish.com/cdn/shop/files/1lbsabalone2.jpg?v=1696278727)
:::

::::

## Sobre o banco de dados

- É um banco de dados da área de biologia que contém medidas físicas de um abalone;

- O banco de dados contém 4177 observações;

- 8 colunas, sendo uma delas nominal e o restante numérica;

- Foi criado por Warwick Nash, Tracy Sellers, Simon Talbot, Andrew Cawthorn, Wes Ford.

## As variáveis do banco de dados {auto-animate="true"}

- Sexo do abalone: variável nominal indicando se o abalone é macho, fêmea ou filhote.

- Length: Medição do maior comprimento da concha

- Diameter: perpendicular ao comprimento

- Height: com carne na casca

## As variáveis do banco de dados

- Whole weight: abalone inteiro

- Shucked weight: peso da carne

- Viscera weight: peso das vísceras

- Shell weight: peso da concha sem carne

# Objetivo

Analisar os dados de abalones utilizando métodos descritivos, fatoriais e de componentes principais.

# Leitura dos dados

```{r}
data <- readr::read_csv("abalone.csv") |>
  mutate(
    Sex = case_when(
      Sex == "F" ~ "Fêmea",
      Sex == "M" ~ "Macho",
      TRUE ~ "Filhote"
      )
    ) |> 
  select(- Rings)
```

# Análise Exploratória

## Valores ausentes

::: {.panel-tabset}

### Código

```{r}
Ausentes <- data |> 
  vis_dat() +
  labs(
    y = "Observações"
    ) +
  scale_fill_manual(
    values = viridis::mako(10)[5:7],
    labels = c("Qualitativa", "Quantitativa")
    ) +
  theme(
    legend.position = "bottom",
    legend.title = element_blank(),
  )
```

### Valores ausentes

```{r echo=FALSE}
Ausentes
```

:::

## Valores ausentes

- Observando todas as variáveis do banco de dados pelo gráfico, vemos que o banco de dados não possui valores ausentes;

- Podemos também ver o tipo de cada uma das variáveis do banco de dados.

## Frequência de cada sexo

::: {.panel-tabset}

### Código

```{r}
Frequência <- data |> 
  ggplot(aes(x = forcats::fct_infreq(Sex))) +
  geom_bar(
        aes(
          y = after_stat(count) / sum(after_stat(count)), 
          fill = Sex
          ),
        show.legend = FALSE,
  ) +
  theme_bw() +
  theme(axis.title.x = element_blank()) +
  scale_fill_manual(
    values = viridis::mako(10)[5:7]
    ) +
  labs(y = NULL, x = NULL) 
```

### Frequência

```{r echo=FALSE}
Frequência
```

:::

## Frequência de cada sexo

- O sexo mais frequente é o macho, seguido pela fêmea em terceiro lugar, com 31,29%, enquanto o macho apresenta 36,58%. Os filhotes representam 32,12%;

- O filhote é considerado como um sexo separado pois não é possível afirmar se é macho ou fêmea.

## Distribuições

::: {.panel-tabset}

### Código

```{r}
Distribuição <- data |>
  pivot_longer(
    !Sex,
    names_to = "variable",
    values_to = "values"
  ) |>
  ggplot(
    aes(
      x = values, 
      fill = Sex
      )
    ) +
  geom_violin(
    aes(y = variable),
    draw_quantiles = c(0.25, 0.5, 0.75),
    ) +
  labs(x = "", y = "") +
  facet_wrap(vars(variable), scales = "free") +
  scale_fill_manual(
    values = viridis::mako(10)[5:7], 
    name = "Sexo"
    ) +
  theme_bw() +
  theme(axis.text.y = element_blank())
```

### Distribuição

```{r echo=FALSE}
Distribuição
```

:::

## Distribuições

- Com exceção do diâmetro e do comprimento da concha, a maioria das variáveis apresenta assimetria positiva;

- O molusco macho é aquele que possuí as maiores medidas e, como é de se esperar, o filhote tem as menores;

## Correlação

::: {.panel-tabset}

### Código

```{r output=FALSE}
data <- data |>
  (\(x) {
     scaled <- x |>
       select_if(is.numeric) |>
       scale() |>
       as_tibble()

     x |>
       select_if(is.character) |>
       cbind(scaled)
  })()

data |>
  select_if(is.numeric) |>
  cor() |>
  corrplot(
      method = "circle",
      col = paletteer_c("ggthemes::Classic Blue", 200),
      diag = FALSE,
      addgrid.col = "#00000040",
      tl.pos = "l",
      tl.cex = 0.6,
      tl.col = "black",
      tl.offset = 0.25,
      cl.length = 9,
      cl.cex = 0.6,
      cl.ratio = 0.25,
      family = "mono"
  )
```

### Matriz de correlação

```{r echo=FALSE}
data |>
  select_if(is.numeric) |>
  cor() |>
  corrplot(
      method = "circle",
      col = paletteer_c("ggthemes::Classic Blue", 200),
      diag = FALSE,
      addgrid.col = "#00000040",
      tl.pos = "l",
      tl.cex = 0.6,
      tl.col = "black",
      tl.offset = 0.25,
      cl.length = 9,
      cl.cex = 0.6,
      cl.ratio = 0.25,
      family = "mono"
  )
```

:::

## Correlação

As variáveis têm uma correlação significativa entre si, sendo o comprimento da concha e o diâmetro as mais correlacionadas. Além disso, perceba que a relação entre as medidas corporais do molusco é diretamente proporcional.

# Classificação Hierárquica

## Dendograma

::: {.panel-tabset}

### Código

```{r output=FALSE}
Mdist <- dist(data |> select_if(is.numeric), method = "euclidean")
CH1 <- hclust(Mdist)
plot(CH1,
     main=" ",
     labels = data$Sex,
     ylab = NULL, 
     ann = FALSE)
```

### Dendograma

```{r echo=FALSE}
Mdist <- dist(data |> select_if(is.numeric), method = "euclidean")
CH1 <- hclust(Mdist)
plot(CH1,
     main=" ",
     labels = data$Sex,
     ylab = NULL, 
     ann = FALSE)
rect.hclust(CH1, k = 3, border = c("#002951","#005129","#a0000a"))
```

:::

## Seleção do modelo

```{r}
m <- c( "average", "single", "complete", "ward")
ac.m <- data.frame(metodo=m,Criterio=rep(0,length(m)))
for (i in 1:length(m)) {
  ac.m[i, 2] <- agnes(data, method = m[i])$ac
}
```

```{r}
CHward <- agnes(data, method = "ward")
CHward <- as.hclust(CHward)
plot(CHward, main=" ",labels = substr(data$Sex, 1, 2), ylab = NULL, ann = FALSE)
rect.hclust(CHward, k = 3, border = c("#002951","#005129","#a0000a"))
###
# CORTANDO EM K=3
corte3 <- cutree(CHward , k = 3)
```


```{r}
# Biplot
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex,1,2), 1:length(corte3))
fviz_cluster(list(data = mdados, cluster = corte3, show_labels = FALSE))
```

# Classificação Não-Hierárquica

## K-means

```{r}
semente <- round(aggregate(data |> select_if(is.numeric), by=list(cluster = data$Sex), mean)[,-1], 2)
```

```{r}
km <- kmeans(data |> select_if(is.numeric), centers = semente)
```

```{r}
table(data.frame(Especie=data$Sex, Classes=km$cluster))
```

```{r}
mdados <- as.matrix(data |> select_if(is.numeric))
rownames(mdados) <- paste(substr(data$Sex, 1, 2),1:dim(data)[1])
fviz_cluster(list(data = mdados, cluster = km$cluster,show_labels = FALSE))
```


# Agrupamento paramétrico

```{r}
BIC <- mclustBIC(data[,-1])
plot(BIC)
summary(BIC)
```

